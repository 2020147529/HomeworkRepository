<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&family=Pacifico&family=Roboto+Mono&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="main.css" />
    <script src="product.json"></script>
    <script type="text/javascript">
      window.onload = () => {
        let device = "all";
        let sort = "none";
        let searchText = "none";
        let product;
        fetch("product.json")
          .then((response) => response.json())
          .then((data) => {
            product = data;
          });

        const CATEGORY = document.querySelector("#category");
        CATEGORY.addEventListener("change", () => {
          window.removeEventListener("scroll", scroll);
          device = CATEGORY.options[CATEGORY.selectedIndex].value;
          console.log(device);
        });

        const SORTING = document.querySelector("#sort");
        SORTING.addEventListener("change", () => {
          window.removeEventListener("scroll", scroll);
          sort = SORTING.options[SORTING.selectedIndex].value;
          console.log(sort);
        });

        const SEARCH = document.querySelector("#search");
        SEARCH.addEventListener("change", () => {
          window.removeEventListener("scroll", scroll);
          searchText = SEARCH.value;
          console.log(searchText);
        });

        const SUBMIT_BUTTON = document.querySelector("#find");
        SUBMIT_BUTTON.addEventListener("click", () => {
          document.querySelector(".group").innerHTML = "";
          let filter = product.filter((obj) => {
            if (device === "all") {
              if (searchText === "none") {
                return product;
              } else {
                return obj.name
                  .toLowerCase()
                  .includes(searchText.toLowerCase());
              }
            } else {
              if (searchText === "none") {
                return obj.category === device;
              } else {
                return (
                  obj.category === device &&
                  obj.name.toLowerCase().includes(searchText.toLowerCase())
                );
              }
            }
          });
          if (filter.length === 0) {
            alert("NO SUCH ELEMENTS! PLEASE SEARCH AGAIN");
          } else {
            if (sort == "ascending") {
              filter = filter.sort((a, b) => {
                return a.price - b.price;
              });
            } else if (sort == "descending") {
              filter = filter.sort((a, b) => {
                return b.price - a.price;
              });
            }
            console.log(filter)
            // onscroll function
            // display 4 each element when user scroll and its height + window.inner height is bigger then document's height
            let totalNum = 0;
            function load(loadNum = 4) {
              for (let i = 0; i < loadNum; i++) {
                if (totalNum < filter.length) {
                  createImgBox(
                    filter[totalNum].name,
                    filter[totalNum].imgsrc,
                    filter[totalNum].price,
                    filter[totalNum].category
                  );
                  totalNum++;
                }
              }
            }
            // first loading the image and display it
            // we should display items at first without scroll event
            load();
            overlayStyleChange();
            window.addEventListener("scroll", function scroll() {
              if (
                window.scrollY + window.innerHeight >=
                document.documentElement.scrollHeight
              ) {
                load();
                overlayStyleChange();
              }
            });
          }
        });

        function createImgBox(title, imgsrc, price, alternative) {
          const imgElement = `<div class="imgbox">
                        <img
                          class="Device"
                          src=${imgsrc}
                          alt=${alternative}
                        />
                        <div class="overlay">
                          <div class="text">${title}</div>
                          <div class="price">${price}&#36;</div>
                        </div>
                      </div>`;
          document.querySelector(".group").innerHTML += imgElement;
        }

        function overlayStyleChange() {
          const OVERLAYS = document.querySelectorAll(".overlay");
          OVERLAYS.forEach((overlay) => {
            overlay.addEventListener("click", function click() {
              overlay.style.backgroundColor = "rgba(0, 0, 0, 0.6)";
              overlay.style.fontSize = "14px";
              overlay.style.opacity = "1";
              overlay.style.color = "#ffc300";
            });
          });
        }
      };
    </script>
    <title>Document</title>
  </head>
  <body class="index">
    <header>
      <h1>Welcome to my Shop!</h1>
      <nav class="page">
        <a href="index.html" id="index">Main Page</a>
        <a href="login.html" id="login">Log In Page</a>
        <a href="signup.html" id="signup">Sign Up Page</a>
      </nav>
    </header>
    <main class="Main">
      <div class="classify" id="classify">
        <div class="category">
          <p>Choose a category</p>
          <select name="category" id="category">
            <option value="all" selected>ALL</option>
            <option value="macbook">MacBook</option>
            <option value="iphone">iPhone</option>
            <option value="ipad">iPad</option>
            <option value="watch">Watch</option>
          </select>
        </div>
        <div class="search">
          <p>Enter what you want</p>
          <input type="text" placeholder="e.g. iPhone" id="search" />
        </div>
        <div class="sort">
          <p>Choose a sort</p>
          <select name="sort" id="sort">
            <option value="none" selected>--SELECT ORDER--</option>
            <option value="ascending">ascending</option>
            <option value="descending">descending</option>
          </select>
        </div>
        <button id="find">Search</button>
      </div>
      <div class="Stuff">
        <div class="group">
          <!-- <div class="imgbox">
            <img class="Device" src="img/MacPro.jpeg" alt="MacBookPro" />
            <div class="overlay">
              <div class="text">MacBook<br />Pro</div>
            </div>
          </div> -->
        </div>
      </div>
    </main>
    <footer>
      <h2>About Apple</h2>
      <article class="Description">
        <p>
          Apple hardware, software, and services work together to give your
          employees the power and flexibility to do whatever needs doing —
          whether you’re running a startup, scale-up, or global enterprise.
        </p>
        <p>
          You can start a project on Mac and finish it on iPad, use your screens
          side by side to extend your workspace, and even draw with Apple Pencil
          on your iPad or use your iPhone to make live updates on your Mac. And
          it’s all compatible with apps from Microsoft and Google, so your team
          has everything it needs to get any job done.
        </p>
        <p>
          Apple devices come with powerful apps built in. The App Store offers
          even more tools for almost any job — from sales and engineering to
          fixing jets and building skyscrapers. And the Apple developer platform
          gives businesses the power to create custom solutions that the world
          has yet to see.
        </p>
      </article>
    </footer>
  </body>
</html>
